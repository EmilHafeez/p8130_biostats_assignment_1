---
title: "P8130 Assignment 1"
author: "Emil Hafeez (eh2928)"
date: "9/18/2020"
output: html_document
---
DONT FORGET TO COMMENT ON last overlaid plots!   

Assignment 1 for Biostatistics P8130, using a dataset called Antibodies, practices data manipulation and descriptive statistics (including table, histogram, and boxplot generation). The dataset contains information on demographic variables, IgM antibodies, and self-reported smell loss for patients diagnosed with COVID-19 (via the PCR gold-standard). 

Let's load the appropriate packages first.
```{r, echo = TRUE, results = 'hide', message = FALSE}
library(arsenal)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(knitr)
```
```

# Question 1
## Question 1, Part 1, Section a)
First, read the CSV and examine the basics.
```{r, results = 'hide'}
#Read the CSV data into a dataframe
antibodies_df <- read.csv("/Users/emilhafeez/Google Drive/Columbia/Fall 2020/Classes/Biostatistics 1/Assignments/Assignment 1/p8130_biostats_assignment_1/Antibodies.csv")
```
I examine the basics of the data, to become familiar. Results are hidden for the sake of brevity.
```{r, results='hide'}
names(antibodies_df)
nrow(antibodies_df)
ncol(antibodies_df)
head(antibodies_df)
tail(antibodies_df)
anyNA(antibodies_df)
str(antibodies_df)
```
Now, we can provide descriptive statistics for all variables of interest. We can see that some variable types need manipulation, too. I suppress the code output here. 
```{r, results = 'hide'}
summary(antibodies_df)

#Make AgeCategory, Smell, and Gender to show N (%). Requires ensuring all unique values, too.
unique(antibodies_df$AgeCategory)
    antibodies_df <- antibodies_df %>% 
        mutate(AgeCategory = factor(AgeCategory, labels = c("18-30", "31-50", "51+") ))
unique(antibodies_df$Smell)
    antibodies_df <- antibodies_df %>% 
        mutate(Smell = factor(Smell, labels = c("Normal","Altered", "Other")))
unique(antibodies_df$Gender)
    antibodies_df <- antibodies_df %>% 
        mutate(Gender = factor(Gender, labels = c("Male","Female")))
```
```{r}
#To prepare a tidy table, let's change variable names/labels by creating a my_labels variable that will modify the tableby() command
my_labels <- list(AgeCategory = "Age Range (Years)", Antibody_IgM = "Antibody Levels(IgM)", Smell = "Smell Changes (Self Report)", Gender = "Gender (M/F)")

#Clean the output by creating a my_controls variable that will modify the tableby() command
my_controls <- tableby.control(
               total = TRUE,
               test = FALSE,
               numeric.stats = c("meansd", "medianq1q3", "range", "Nmiss2"),
               cat.stats = c("countpct", "Nmiss2"),
               stats.labels = list(
               meansd = "Mean (SD)",
               medianq1q3 = "Median (Q1, Q3)",
               range = "Min - Max",
               Nmiss2 = "Missing",
               countpct = "N (%)"))
```

```{r}
#Making a table
table_1 <- tableby( ~ AgeCategory + Antibody_IgM + Smell + Gender, data = antibodies_df, control = my_controls)
summary(table_1, title = "Descriptive Statistics: Antibodies & Smell Data", labelTranslations = my_labels, text = TRUE)
```

### Question 1, Part 1, Section b)
```{r}
#1.0475
min(antibodies_df$Antibody_IgM)
#0.0480

ggplot(antibodies_df, aes(Antibody_IgM)) +
  geom_histogram(col = "black", fill = "red", breaks = seq(0.0400,1.05,.01)) +
  geom_vline(aes(xintercept = mean(Antibody_IgM, na.rm = TRUE)), color = "blue", linetype = "dashed", size = 1) +
  labs(title = "Histogram of Antibody Count") + 
  labs(x = "Antibody Count (IgM(", y = "Frequency")
```
The histogram seems to show a strong positive skew (right skew). The distribution appears to to have higher frequencies of antibody counts closer to the minimum of 0.0480. The mean antibody count of approximately 0.1239 is higher than the median of 0.0915 in this distribution.

## Question 1, Part 2, Section a)
Let's display the descriptive statistics for all variables, this time stratified by Smell category
```{r}
#Similar structure to the above code, though note that Smell appears as a stratifier before the '~'
table_2 <- tableby( Smell ~ AgeCategory + Antibody_IgM + Smell + Gender, data = antibodies_df, control = my_controls)
summary(table_2, title = "Descriptive Statistics: Antibodies & Smell Data", labelTranslations = my_labels, text = TRUE)
```
## Question 1, Part 2, Section b)
```{r, warning = FALSE}
# Generate overlaid histograms and boxplots with a variety of formatting edits, including aesthetic and labeling.
# Histogram
ggplot(antibodies_df, aes(x = Antibody_IgM, fill = factor(Smell))) +
  geom_histogram(binwidth = .5, alpha = .5, position = "identity", col = "black", breaks = seq(0.0400,1.05,.1)) +
  geom_vline(aes(xintercept = mean(Antibody_IgM, na.rm = TRUE)), color = "red", size = 1.5) +
  labs(title = "Overlaid Histograms of Antibody Count by Smell Category") +
  labs(x = "Antibody Count(IgM)", y = "Count") +
  scale_fill_discrete(name = "Smell Variation", labels = c("Normal", "Altered", "Other"))
# Boxplot 
ggplot(antibodies_df, aes(x = Smell, y = Antibody_IgM, fill = Smell)) +
  geom_boxplot(outlier.colour = "black", outlier.shape = 16,
               outlier.size = 2, notch = FALSE) +
  scale_fill_manual(values = c("blue", "red", "yellow"),
                    labels = expression("Normal", "Altered", "Other")) +
  xlab("") +
  ylab("Antibody Count (IgM)") +
  theme(legend.position = "top", legend.title = element_blank())
```
Utilizing these overlaid histograms and boxplots, we can see that while both the Smell categories of Normal and Altered appear to show a positive (right) skew in their distributions of Antibody Count (IgM), with long tails extending to the right (or up, in the boxplots) and a substantial number of outliers. 
However, it does appear that the Normal category has higher variation, including a larger interquartile range than the Altered group, as well as more extreme outliers. These groups do have overlapping boxplots, though. The Other category, a small portion of the dataset, overlaps with the IQR of the other two categories.

# Question 2
## Question 2, Summary and Three Focus Points



